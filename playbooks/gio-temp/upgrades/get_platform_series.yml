---
- name: Prompt for variables if needed
  hosts: localhost
  gather_facts: false
  
  tasks:
    - name: Display available inventory groups
      when: target_hosts is not defined
      debug:
        msg: |
          Available groups:
          {% for g in groups.keys() | sort %}
          - {{ g }}
          {% endfor %}
          
          You can specify host(s) or group(s) separated by commas (e.g., router,switch1,switch4)

    - name: Prompt for target hosts
      pause:
        prompt: "Enter target hosts (comma-separated)"
      register: target_hosts_input
      when: target_hosts is not defined or target_hosts == ""

    - name: Set target_hosts
      set_fact:
        target_hosts: "{{ target_hosts_input.user_input }}"
      when: target_hosts_input is defined and target_hosts_input.user_input is defined


- name: Get Device platforms Playbook
  hosts: "{{ hostvars['localhost']['target_hosts'].split(',') }}"
  gather_facts: false
  connection: network_cli

  vars:
    required_suffixes:
      - "_target_image"
      - "_md5_hash"
      - "_image_size_bytes"
      - "_image_code"

  tasks:
  
    - name: Show platform for selected hosts/groups
      debug:
        var: hostvars[inventory_hostname]["platform_series"]

    # - name: Check that all of these platform series have correct values, if you see MISSING, verify images.yml
    #   vars:
    #     all_groups: "{{ groups.keys() | list }}"
    #   debug:
    #     msg: |
    #       Group: {{ item }}
    #       {% set expected_vars = required_suffixes | map('regex_replace', '^(.*)$', item ~ '\\1') | list %}
    #       {% for key in expected_vars %}
    #       - {{ key }}: {{ vars.get(key, 'MISSING') }}
    #       {% endfor %}
    #   loop: "{{ all_groups }}"
    #   loop_control:
    #     label: "{{ item }}"